[{"detail":{"_extra":[],"form_vars":[],"forms":[],"main":[{"action_entity$code":"meiran_test","action_entity_id":"1082","code":"one_crm_import","created_at":"2022-01-24 09:28:51","created_by":"1","diagram":"\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cdefinitions xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:omgdc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:omgdi=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" targetNamespace=\"\" xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd\"\u003e\n  \u003cprocess id=\"sid-902ce12e-9687-4106-be7d-5e41bced24d3\" name=\"Customer\" processType=\"None\" isClosed=\"false\" isExecutable=\"false\"\u003e\n    \u003cstartEvent id=\"StartEvent_0zzehe8\"\u003e\n      \u003coutgoing\u003eSequenceFlow_1g44s5q\u003c/outgoing\u003e\n    \u003c/startEvent\u003e\n    \u003csequenceFlow id=\"SequenceFlow_1g44s5q\" sourceRef=\"StartEvent_0zzehe8\" targetRef=\"UserTask_19sxm6q\" /\u003e\n    \u003cuserTask id=\"UserTask_19sxm6q\" name=\"Выбор файла\"\u003e\n      \u003cincoming\u003eSequenceFlow_1g44s5q\u003c/incoming\u003e\n      \u003coutgoing\u003eSequenceFlow_1g9dzmd\u003c/outgoing\u003e\n    \u003c/userTask\u003e\n    \u003csequenceFlow id=\"SequenceFlow_1g9dzmd\" sourceRef=\"UserTask_19sxm6q\" targetRef=\"ScriptTask_04e5cpf\" /\u003e\n    \u003cscriptTask id=\"ScriptTask_04e5cpf\" name=\"Просмотр\"\u003e\n      \u003cincoming\u003eSequenceFlow_1g9dzmd\u003c/incoming\u003e\n      \u003coutgoing\u003eSequenceFlow_1k3ex29\u003c/outgoing\u003e\n    \u003c/scriptTask\u003e\n    \u003cexclusiveGateway id=\"ExclusiveGateway_00m28yc\"\u003e\n      \u003cincoming\u003eSequenceFlow_1k3ex29\u003c/incoming\u003e\n      \u003coutgoing\u003eSequenceFlow_016gklj\u003c/outgoing\u003e\n    \u003c/exclusiveGateway\u003e\n    \u003csequenceFlow id=\"SequenceFlow_1k3ex29\" sourceRef=\"ScriptTask_04e5cpf\" targetRef=\"ExclusiveGateway_00m28yc\" /\u003e\n    \u003csequenceFlow id=\"SequenceFlow_016gklj\" sourceRef=\"ExclusiveGateway_00m28yc\" targetRef=\"ScriptTask_1by3l2s\" /\u003e\n    \u003cscriptTask id=\"ScriptTask_1by3l2s\" name=\"Планы\"\u003e\n      \u003cincoming\u003eSequenceFlow_016gklj\u003c/incoming\u003e\n      \u003coutgoing\u003eSequenceFlow_0syruj5\u003c/outgoing\u003e\n    \u003c/scriptTask\u003e\n    \u003cendEvent id=\"EndEvent_174o84e\"\u003e\n      \u003cincoming\u003eSequenceFlow_0syruj5\u003c/incoming\u003e\n    \u003c/endEvent\u003e\n    \u003csequenceFlow id=\"SequenceFlow_0syruj5\" sourceRef=\"ScriptTask_1by3l2s\" targetRef=\"EndEvent_174o84e\" /\u003e\n  \u003c/process\u003e\n  \u003cbpmndi:BPMNDiagram id=\"sid-959c5c16-23d5-4159-9c7b-b17b5ced9f7a\"\u003e\n    \u003cbpmndi:BPMNPlane id=\"sid-730119e6-5401-4634-ab5e-4048023f8954\" bpmnElement=\"sid-902ce12e-9687-4106-be7d-5e41bced24d3\"\u003e\n      \u003cbpmndi:BPMNShape id=\"StartEvent_0zzehe8_di\" bpmnElement=\"StartEvent_0zzehe8\"\u003e\n        \u003comgdc:Bounds x=\"290.60722891566263\" y=\"-221.29397590361452\" width=\"36\" height=\"36\" /\u003e\n        \u003cbpmndi:BPMNLabel\u003e\n          \u003comgdc:Bounds x=\"263.60722891566263\" y=\"-185.29397590361452\" width=\"90\" height=\"20\" /\u003e\n        \u003c/bpmndi:BPMNLabel\u003e\n      \u003c/bpmndi:BPMNShape\u003e\n      \u003cbpmndi:BPMNEdge id=\"SequenceFlow_1g44s5q_di\" bpmnElement=\"SequenceFlow_1g44s5q\"\u003e\n        \u003comgdi:waypoint xsi:type=\"omgdc:Point\" x=\"326\" y=\"-203\" /\u003e\n        \u003comgdi:waypoint xsi:type=\"omgdc:Point\" x=\"406\" y=\"-203\" /\u003e\n        \u003cbpmndi:BPMNLabel\u003e\n          \u003comgdc:Bounds x=\"321\" y=\"-213\" width=\"90\" height=\"20\" /\u003e\n        \u003c/bpmndi:BPMNLabel\u003e\n      \u003c/bpmndi:BPMNEdge\u003e\n      \u003cbpmndi:BPMNShape id=\"UserTask_19sxm6q_di\" bpmnElement=\"UserTask_19sxm6q\"\u003e\n        \u003comgdc:Bounds x=\"405.60133630289533\" y=\"-243\" width=\"100\" height=\"80\" /\u003e\n      \u003c/bpmndi:BPMNShape\u003e\n      \u003cbpmndi:BPMNEdge id=\"SequenceFlow_1g9dzmd_di\" bpmnElement=\"SequenceFlow_1g9dzmd\"\u003e\n        \u003comgdi:waypoint xsi:type=\"omgdc:Point\" x=\"506\" y=\"-203\" /\u003e\n        \u003comgdi:waypoint xsi:type=\"omgdc:Point\" x=\"598\" y=\"-203\" /\u003e\n        \u003cbpmndi:BPMNLabel\u003e\n          \u003comgdc:Bounds x=\"507\" y=\"-213\" width=\"90\" height=\"20\" /\u003e\n        \u003c/bpmndi:BPMNLabel\u003e\n      \u003c/bpmndi:BPMNEdge\u003e\n      \u003cbpmndi:BPMNShape id=\"ScriptTask_04e5cpf_di\" bpmnElement=\"ScriptTask_04e5cpf\"\u003e\n        \u003comgdc:Bounds x=\"597.517\" y=\"-243\" width=\"100\" height=\"80\" /\u003e\n      \u003c/bpmndi:BPMNShape\u003e\n      \u003cbpmndi:BPMNShape id=\"ExclusiveGateway_00m28yc_di\" bpmnElement=\"ExclusiveGateway_00m28yc\" isMarkerVisible=\"true\"\u003e\n        \u003comgdc:Bounds x=\"823.6506849315068\" y=\"-228\" width=\"50\" height=\"50\" /\u003e\n        \u003cbpmndi:BPMNLabel\u003e\n          \u003comgdc:Bounds x=\"803.6506849315068\" y=\"-178\" width=\"90\" height=\"20\" /\u003e\n        \u003c/bpmndi:BPMNLabel\u003e\n      \u003c/bpmndi:BPMNShape\u003e\n      \u003cbpmndi:BPMNEdge id=\"SequenceFlow_1k3ex29_di\" bpmnElement=\"SequenceFlow_1k3ex29\"\u003e\n        \u003comgdi:waypoint xsi:type=\"omgdc:Point\" x=\"698\" y=\"-203\" /\u003e\n        \u003comgdi:waypoint xsi:type=\"omgdc:Point\" x=\"824\" y=\"-203\" /\u003e\n        \u003cbpmndi:BPMNLabel\u003e\n          \u003comgdc:Bounds x=\"716\" y=\"-213\" width=\"90\" height=\"20\" /\u003e\n        \u003c/bpmndi:BPMNLabel\u003e\n      \u003c/bpmndi:BPMNEdge\u003e\n      \u003cbpmndi:BPMNEdge id=\"SequenceFlow_016gklj_di\" bpmnElement=\"SequenceFlow_016gklj\"\u003e\n        \u003comgdi:waypoint xsi:type=\"omgdc:Point\" x=\"874\" y=\"-203\" /\u003e\n        \u003comgdi:waypoint xsi:type=\"omgdc:Point\" x=\"996\" y=\"-203\" /\u003e\n        \u003cbpmndi:BPMNLabel\u003e\n          \u003comgdc:Bounds x=\"890\" y=\"-213\" width=\"90\" height=\"20\" /\u003e\n        \u003c/bpmndi:BPMNLabel\u003e\n      \u003c/bpmndi:BPMNEdge\u003e\n      \u003cbpmndi:BPMNShape id=\"ScriptTask_1by3l2s_di\" bpmnElement=\"ScriptTask_1by3l2s\"\u003e\n        \u003comgdc:Bounds x=\"995.6506849315069\" y=\"-243\" width=\"100\" height=\"80\" /\u003e\n      \u003c/bpmndi:BPMNShape\u003e\n      \u003cbpmndi:BPMNShape id=\"EndEvent_174o84e_di\" bpmnElement=\"EndEvent_174o84e\"\u003e\n        \u003comgdc:Bounds x=\"1170\" y=\"-221\" width=\"36\" height=\"36\" /\u003e\n        \u003cbpmndi:BPMNLabel\u003e\n          \u003comgdc:Bounds x=\"1143\" y=\"-185\" width=\"90\" height=\"20\" /\u003e\n        \u003c/bpmndi:BPMNLabel\u003e\n      \u003c/bpmndi:BPMNShape\u003e\n      \u003cbpmndi:BPMNEdge id=\"SequenceFlow_0syruj5_di\" bpmnElement=\"SequenceFlow_0syruj5\"\u003e\n        \u003comgdi:waypoint xsi:type=\"omgdc:Point\" x=\"1096\" y=\"-203\" /\u003e\n        \u003comgdi:waypoint xsi:type=\"omgdc:Point\" x=\"1170\" y=\"-203\" /\u003e\n        \u003cbpmndi:BPMNLabel\u003e\n          \u003comgdc:Bounds x=\"1088\" y=\"-213\" width=\"90\" height=\"20\" /\u003e\n        \u003c/bpmndi:BPMNLabel\u003e\n      \u003c/bpmndi:BPMNEdge\u003e\n    \u003c/bpmndi:BPMNPlane\u003e\n  \u003c/bpmndi:BPMNDiagram\u003e\n\u003c/definitions\u003e\n","id":"615","is_active":"0","is_public":"1","module$code":"fm_crm_test","module_id":"43","sys$uuid":"2f94fce1-61af-489c-a07d-f1c793d70dde","title":"Импорт","type$code":"entityTool","type_id":"4","updated_at":"2022-01-24 09:58:42"}],"point_datamaps":[],"point_sfs":[{"id":"6410","is_active":"1","is_incoming":"0","point$code":"StartEvent_0zzehe8","point_id":"3345","sf$code":"SequenceFlow_1g44s5q","sf_id":"3131","sys$uuid":"d1cd594b-490e-44f0-9737-61650bd116e6"},{"id":"6411","is_active":"1","is_incoming":"1","point$code":"UserTask_19sxm6q","point_id":"3346","sf$code":"SequenceFlow_1g44s5q","sf_id":"3131","sys$uuid":"6df3cb3c-ae58-4480-aada-060213024d03"},{"id":"6412","is_active":"1","is_incoming":"0","point$code":"UserTask_19sxm6q","point_id":"3346","sf$code":"SequenceFlow_1g9dzmd","sf_id":"3132","sys$uuid":"0f4a3c81-00a9-4b26-aa40-4dca82f7a578"},{"id":"6413","is_active":"1","is_incoming":"1","point$code":"ScriptTask_04e5cpf","point_id":"3347","sf$code":"SequenceFlow_1g9dzmd","sf_id":"3132","sys$uuid":"90c8e7a3-d3da-4973-9857-6c5aa234e5f7"},{"id":"6414","is_active":"1","is_incoming":"0","point$code":"ScriptTask_04e5cpf","point_id":"3347","sf$code":"SequenceFlow_1k3ex29","sf_id":"3133","sys$uuid":"ec2de232-a672-41b2-8904-99a60ce87394"},{"id":"6417","is_active":"1","is_incoming":"1","point$code":"ScriptTask_1by3l2s","point_id":"3348","sf$code":"SequenceFlow_016gklj","sf_id":"3134","sys$uuid":"e215abe0-b523-40cf-a806-86107ee7e856"},{"id":"6418","is_active":"1","is_incoming":"0","point$code":"ScriptTask_1by3l2s","point_id":"3348","sf$code":"SequenceFlow_0syruj5","sf_id":"3135","sys$uuid":"31909386-4cf1-4b11-b6e3-c623f7df84f1"},{"id":"6415","is_active":"1","is_incoming":"1","point$code":"ExclusiveGateway_00m28yc","point_id":"3349","sf$code":"SequenceFlow_1k3ex29","sf_id":"3133","sys$uuid":"4a24c1b7-ea27-470a-96a0-4da1c5aff38c"},{"id":"6416","is_active":"1","is_incoming":"0","point$code":"ExclusiveGateway_00m28yc","point_id":"3349","sf$code":"SequenceFlow_016gklj","sf_id":"3134","sys$uuid":"098f07c4-0a2b-498e-a94d-1b896b2dc54a"},{"id":"6419","is_active":"1","is_incoming":"1","point$code":"EndEvent_174o84e","point_id":"3350","sf$code":"SequenceFlow_0syruj5","sf_id":"3135","sys$uuid":"730df48e-6da1-4e3a-a134-467a177ea20a"}],"point_vars":[{"created_at":"2022-01-24 09:41:52","id":"4936","is_cond_rq":"0","is_input":"0","is_output":"1","is_rq":"0","point$code":"UserTask_19sxm6q","point_id":"3346","sys$uuid":"730ed3e0-ca37-4323-a0e2-7775f6a36ad3","updated_at":"0000-00-00 00:00:00","var$code":"plans","var_id":"2577"},{"created_at":"2022-01-24 09:44:53","id":"4937","is_cond_rq":"0","is_input":"0","is_output":"1","is_rq":"0","point$code":"UserTask_19sxm6q","point_id":"3346","sys$uuid":"662c76ba-1f1f-48ae-bda7-376bb7bcf06e","updated_at":"0000-00-00 00:00:00","var$code":"cli_file_id","var_id":"2578"}],"points":[{"code":"StartEvent_0zzehe8","created_at":"2022-01-24 09:35:41","id":"3345","is_active":"1","is_auto":"1","is_loop":"0","is_timerevent":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"296d1928-0183-467e-bd04-bc14a7de131d","title":"","type$code":"startevent","type_id":"2","updated_at":"2022-01-24 11:16:12"},{"actor$code":"initiator","actor_id":"1","actor_type$code":"actor","actor_type_id":"1","code":"UserTask_19sxm6q","created_at":"2022-01-24 09:35:41","form":"\u003ch3\u003eВыбор файла\u003c/h3\u003e\r\n\u003cdiv class = \"row\"\u003e    \r\n    \u003cdiv class=\"col-md-12\" ng-show=\"1==1\"\u003e\r\n    \u003clabel\u003e\u003c/label\u003e\r\n    \u003cbu-file-uploader  on-before-upload-item=\"onBeforeUploadItem\" dir=\"CUST\"  on-change=\"edit\"  uuid-model=\"value.var.cli_file_id\" id-model=\"var.cli_file_id\"\u003e\u003c/bu-file-uploader\u003e\r\n    \u003c/div\u003e  \r\n\u003c/div\u003e\r\n\u003cdiv class=\"row\"\u003e\r\n    \u003cdiv class=\"col-md-12\" ng-show=\"1==1\"\u003e\u003cbu-checkbox label=\"План\" id-model=\"var.plans\" \u003e\u003c/bu-checkbox\u003e\u003c/div\u003e\r\n    \u003c!--\u003cdiv class=\"col-md-12\" ng-show=\"1==1\"\u003e\u003cbu-checkbox label=\"Займы\" id-model=\"var.loans\" \u003e\u003c/bu-checkbox\u003e\u003c/div\u003e\r\n    \u003cdiv class=\"col-md-12\" ng-show=\"1==1\"\u003e\u003cbu-checkbox label=\"Платежи\" id-model=\"var.pays\" \u003e\u003c/bu-checkbox\u003e\u003c/div\u003e--\u003e\r\n\u003c/div\u003e\r\n\u003cdiv class=\"row\"\u003e\r\n    \u003cdiv class=\"col-md-12\"\u003e\u003cbutton class=\"btn btn-primary\" translate ng-click=\"runUserTask()\"\u003e{{ 'Next' | translate}}\u003c/button\u003e\u003c/div\u003e        \r\n\u003c/div\u003e","id":"3346","is_active":"1","is_auto":"0","is_loop":"0","is_timerevent":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"a63fce4e-14ce-48fd-8613-fd1ab31b883c","title":"Выбор файла","type$code":"usertask","type_id":"1","updated_at":"2022-01-24 11:16:12"},{"code":"ScriptTask_04e5cpf","created_at":"2022-01-24 09:45:37","id":"3347","is_active":"1","is_auto":"0","is_loop":"0","is_timerevent":"0","process$code":"one_crm_import","process_id":"615","script_txt":"print(\"var.plans =\", var.clients)","script_type$code":"lua","script_type_id":"1","sys$uuid":"3f3295b9-2f09-476a-b62d-2a0344f3dab5","title":"Просмотр","type$code":"scripttask","type_id":"6","updated_at":"2022-01-24 11:16:12"},{"code":"ScriptTask_1by3l2s","created_at":"2022-01-24 09:47:42","id":"3348","is_active":"1","is_auto":"0","is_loop":"0","is_timerevent":"0","process$code":"one_crm_import","process_id":"615","script_txt":"print(\"===\u003e Импорт планов. Start \")\nfilename,contentType,data,errText,errNum = FileContent(var.cli_file_id,sys.user_id)\nif errNum~=0 then print(\"errText[FileContent] =\", errText) return end\n\ndata = StrReplace(data,'\"','',-1)\ndata = StrReplace(data,'\u0026quot;','',-1)\n\nvalues,errText,errNum = CSVRead(data,\";\")\nif errNum~=0 then print(\"errText[CSVRead] =\", errText) return end\n\nmap = {}\n\nfor k,v in pairs (values) do\n    if k==1 then\n        for k1,v1 in pairs (v) do\n            map[StrReplace(v1,' ','',-1)] = k1\n        end\n    else\n        v_base_ymd = v[map[\"Дата\"]]\n        v_name = v[map[\"Филиал\"]]\n        v_plan = v[map[\"План\"]]\n        v_created_by = sys.user_id\n        SqlInsert([[insert into damucrm.one_crm_sales_plan (base_ymd, name,plan,created_by) values (?,?,?,?)]], v_base_ymd,v_name,v_plan,v_created_by)\n    end\n    \nend\n\nCommitTransaction()\n\n\nprint(\"===\u003e Импорт планов. End \")\n","script_type$code":"lua","script_type_id":"1","sys$uuid":"025ecd75-fc31-4308-8e45-849aa26f9e5e","title":"Планы","type$code":"scripttask","type_id":"6","updated_at":"2022-01-24 11:16:12"},{"code":"ExclusiveGateway_00m28yc","created_at":"2022-01-24 09:47:42","id":"3349","is_active":"1","is_auto":"1","is_loop":"0","is_timerevent":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"2f363ed6-ac8c-4b92-86c8-a23f2596d530","title":"","type$code":"exclusivegateway","type_id":"4","updated_at":"2022-01-24 11:16:12"},{"code":"EndEvent_174o84e","created_at":"2022-01-24 09:49:49","form":"\u003ch3\u003e\u003c/h3\u003e\r\n\u003cbutton class=\"btn btn-primary\" translate ng-click=\"finish()\"\u003eFinish\u003c/button\u003e","id":"3350","is_active":"1","is_auto":"1","is_loop":"0","is_timerevent":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"0f5c50f0-669f-4d9c-a7a6-0e4e13a8375d","title":"","type$code":"endevent","type_id":"3","updated_at":"2022-01-24 11:16:12"}],"process_vars":[{"code":"plans","data_type$code":"boolean","data_type_id":"9","id":"2577","is_array":"0","is_input":"0","is_output":"0","is_rq":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"65cc6ffd-fe8c-402c-962a-a8ca504d9724","title":"План"},{"code":"cli_file_id","data_type$code":"reference","data_type_id":"7","entity_link$code":"files","entity_link_id":"30","id":"2578","is_array":"0","is_input":"0","is_output":"0","is_rq":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"59d481fd-7c78-425b-a13c-e8621486ad74","title":"Клиенты"}],"sequence_flows":[{"code":"SequenceFlow_1g44s5q","id":"3131","is_active":"1","is_auto":"1","is_condition":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"42652858-028c-427a-83fe-93b3dadf8b41","title":""},{"code":"SequenceFlow_1g9dzmd","id":"3132","is_active":"1","is_auto":"1","is_condition":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"aa1a29f4-d374-420f-a055-a36bb6bca76e","title":""},{"code":"SequenceFlow_1k3ex29","id":"3133","is_active":"1","is_auto":"1","is_condition":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"c3918c1e-71e4-4f86-93e3-951b93de2404","title":""},{"code":"SequenceFlow_016gklj","id":"3134","is_active":"1","is_auto":"1","is_condition":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"07b8e87c-7349-45da-962a-86f94903d824","title":""},{"code":"SequenceFlow_0syruj5","id":"3135","is_active":"1","is_auto":"1","is_condition":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"92736d07-69cd-4a7e-b216-c9ecb4382753","title":""}],"vars":[{"code":"plans","data_type$code":"boolean","data_type_id":"9","id":"2577","is_array":"0","is_input":"0","is_output":"0","is_rq":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"65cc6ffd-fe8c-402c-962a-a8ca504d9724","title":"План"},{"code":"cli_file_id","data_type$code":"reference","data_type_id":"7","entity_link$code":"files","entity_link_id":"30","id":"2578","is_array":"0","is_input":"0","is_output":"0","is_rq":"0","process$code":"one_crm_import","process_id":"615","sys$uuid":"59d481fd-7c78-425b-a13c-e8621486ad74","title":"Клиенты"}]},"detail_code":"bp_processes_export","object_type":"bp_process","object_version":"1.0"}]